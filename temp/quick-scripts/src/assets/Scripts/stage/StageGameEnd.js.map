{"version":3,"sources":["assets\\Scripts\\stage\\StageGameEnd.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAA,+CAA0C;AAC1C,iDAA4C;AAC5C,0DAAwE;AACxE,4DAA0E;AAC1E,iCAA4B;AAE5B,uCAA8C;AAGxC,IAAA,KAAsB,EAAE,CAAC,UAAU,EAAlC,OAAO,aAAA,EAAE,QAAQ,cAAiB,CAAC;AAG1C;IAA0C,gCAAK;IAA/C;QAAA,qEAqHC;QAnHwB,aAAO,GAAc,IAAI,CAAC;QAC1B,aAAO,GAAc,IAAI,CAAC;QAC5B,qBAAe,GAAc,EAAE,CAAC;QAC3B,eAAS,GAAmB,EAAE,CAAC;QACpC,kBAAY,GAAY,IAAI,CAAC;QAC7B,mBAAa,GAAY,IAAI,CAAC;QAIzC,gBAAU,GAAY,CAAC,OAAO,EAAE,OAAO,EAAE,OAAO,CAAC,CAAC;;IA0G9D,CAAC;qBArHoB,YAAY;IAa7B,wBAAwB;IAExB,6BAAM,GAAN;QACI,cAAY,CAAC,QAAQ,GAAG,IAAI,CAAC;IACjC,CAAC;IAED,4BAAK,GAAL;QACI,IAAI,CAAC,OAAO,CAAC,YAAY,GAAG,IAAI,CAAC;QACjC,IAAI,CAAC,OAAO,CAAC,YAAY,GAAG,KAAK,CAAC;IACtC,CAAC;IAED,iBAAiB;IAEjB,iCAAU,GAAV,UAAW,IAAI;QACX,IAAG,IAAI,CAAC,MAAM,GAAG,CAAC,EAAE;YAChB,IAAI,CAAC,YAAY,CAAC,MAAM,GAAG,IAAI,CAAC;YAChC,IAAI,CAAC,aAAa,CAAC,MAAM,GAAG,KAAK,CAAC;YAClC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,EAAE;gBACxB,IAAG,CAAC,GAAG,IAAI,CAAC,MAAM,EAAE;oBAChB,IAAI,GAAG,GAAkB;wBACrB,KAAK,EAAE,sBAAS,CAAC,QAAQ;wBACzB,MAAM,EAAE,2BAAc,CAAC,OAAO;wBAC9B,WAAW,EAAE,EAAE;wBACf,IAAI,EAAE,CAAC;wBACP,KAAK,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,KAAK;qBACvB,CAAA;oBAED,qBAAW,CAAC,QAAQ,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,WAAW,EAAE,GAAG,CAAC,CAAC;oBAE3D,IAAI,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,MAAM,GAAG,IAAI,CAAC;oBACtC,IAAI,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,cAAc,CAAC,cAAc,CAAC,CAAC,YAAY,CAAC,EAAE,CAAC,QAAQ,CAAC;yBAC3E,OAAO,CAAC,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC,CAAC;oBACnD,IAAI,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC,YAAY,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,MAAM;wBACvE,oBAAU,CAAC,MAAM,UAAI,IAAI,CAAC,CAAC,CAAC,CAAC,WAAW,GAAG,CAAC,CAAE,CAAC;oBACtD,IAAI,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,cAAc,CAAC,UAAU,CAAC,CAAC,YAAY,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,MAAM;wBAC5E,IAAI,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,QAAQ,EAAE,CAAC;iBAChC;qBAAM;oBACH,IAAI,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,MAAM,GAAG,KAAK,CAAC;iBAC1C;aACJ;SACJ;aAAM;YACH,IAAI,CAAC,YAAY,CAAC,MAAM,GAAG,KAAK,CAAC;YACjC,IAAI,CAAC,aAAa,CAAC,MAAM,GAAG,IAAI,CAAC;YAEjC,IAAI,SAAS,GAAG,YAAY,CAAC,OAAO,CAAC,iBAAiB,CAAC,CAAC;YACxD,IAAG,CAAC,SAAS,IAAI,SAAS,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC,KAAK,EAAE;gBACxC,SAAS,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC;aAC7B;YACD,YAAY,CAAC,OAAO,CAAC,iBAAiB,EAAE,SAAS,CAAC,CAAC;YAEnD,IAAI,CAAC,aAAa,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC,YAAY,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,MAAM;gBAClE,oBAAU,CAAC,MAAM,UAAI,IAAI,CAAC,CAAC,CAAC,CAAC,WAAW,GAAG,CAAC,CAAE,CAAC;YACtD,IAAI,CAAC,aAAa,CAAC,cAAc,CAAC,UAAU,CAAC,CAAC,YAAY,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,MAAM;gBACvE,IAAI,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,QAAQ,EAAE,CAAC;YAC7B,IAAI,CAAC,aAAa,CAAC,cAAc,CAAC,cAAc,CAAC,CAAC,YAAY,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,MAAM;gBAC3E,SAAS,CAAC,QAAQ,EAAE,CAAC;YACzB,IAAI,CAAC,aAAa,CAAC,cAAc,CAAC,cAAc,CAAC,CAAC,YAAY,CAAC,EAAE,CAAC,QAAQ,CAAC;iBACtE,OAAO,CAAC,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC,CAAC;SACtD;QAED,kBAAQ,CAAC,IAAI,CAAC,iBAAM,CAAC,YAAY,CAAC,CAAC;QACnC,kBAAQ,CAAC,OAAO,CAAC,kBAAQ,CAAC,QAAQ,CAAC,aAAa,CAAC,CAAC;QAClD,iDAAiD;QACjD,uBAAuB;QACvB,oCAAoC;QACpC,2EAA2E;QAC3E,yBAAyB;QACzB,IAAI;IACR,CAAC;IAED,gCAAS,GAAT;QACI,kBAAQ,CAAC,OAAO,CAAC,kBAAQ,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC;QAC/C,IAAI,CAAC,OAAO,CAAC,YAAY,GAAG,IAAI,CAAC;QACjC,IAAI,CAAC,OAAO,CAAC,YAAY,GAAG,KAAK,CAAC;QAElC,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,GAAG,EAAE,EAAC,KAAK,EAAE,IAAI,EAAC,CAAC,CAAC,EAAE,CAAC,GAAG,EAAE,EAAC,KAAK,EAAE,GAAG,EAAC,CAAC;aACvE,IAAI,CAAC;YACF,kBAAQ,CAAC,IAAI,CAAC,iBAAM,CAAC,UAAU,CAAC,CAAC;QACrC,CAAC,CAAC,CAAC,KAAK,EAAE,CAAC;IACf,CAAC;IAED,oCAAa,GAAb;QACI,IAAI,GAAG,GAAkB;YACrB,KAAK,EAAE,sBAAS,CAAC,QAAQ;YACzB,MAAM,EAAE,2BAAc,CAAC,IAAI;YAC3B,WAAW,EAAE,EAAE;SAClB,CAAA;QACD,qBAAW,CAAC,QAAQ,CAAC,gBAAgB,CAAC,GAAG,CAAC,CAAC;QAE3C,kBAAQ,CAAC,OAAO,CAAC,kBAAQ,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC;QAC/C,IAAI,CAAC,OAAO,CAAC,YAAY,GAAG,KAAK,CAAC;QAClC,IAAI,CAAC,OAAO,CAAC,YAAY,GAAG,IAAI,CAAC;QAEjC,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,GAAG,EAAE,EAAC,KAAK,EAAE,IAAI,EAAC,CAAC,CAAC,EAAE,CAAC,GAAG,EAAE,EAAC,KAAK,EAAE,GAAG,EAAC,CAAC;aACvE,IAAI,CAAC;YACF,kBAAQ,CAAC,QAAQ,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC;QAC5C,CAAC,CAAC,CAAC,KAAK,EAAE,CAAC;IACf,CAAC;IAED,mCAAY,GAAZ,UAAa,SAAkB;QAC3B,kBAAQ,CAAC,OAAO,CAAC,kBAAQ,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC;QAC/C,IAAI,CAAC,OAAO,CAAC,YAAY,GAAG,CAAC,SAAS,CAAC;QACvC,IAAI,CAAC,OAAO,CAAC,YAAY,GAAG,SAAS,CAAC;IAC1C,CAAC;;IA3GM,qBAAQ,GAAiB,IAAI,CAAC;IAPhB;QAApB,QAAQ,CAAC,EAAE,CAAC,MAAM,CAAC;iDAA2B;IAC1B;QAApB,QAAQ,CAAC,EAAE,CAAC,MAAM,CAAC;iDAA2B;IAC5B;QAAlB,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;yDAAiC;IAC3B;QAAvB,QAAQ,CAAC,EAAE,CAAC,SAAS,CAAC;mDAAgC;IACpC;QAAlB,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;sDAA8B;IAC7B;QAAlB,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;uDAA+B;IAPhC,YAAY;QADhC,OAAO;OACa,YAAY,CAqHhC;IAAD,mBAAC;CArHD,AAqHC,CArHyC,eAAK,GAqH9C;kBArHoB,YAAY","file":"","sourceRoot":"/","sourcesContent":["import SoundMgr from \"../common/SoundMgr\";\r\nimport GameDefine from \"../game/GameDefine\";\r\nimport { PeerActionType, PeerPhase } from \"../PeerComponent/PeerDefine\";\r\nimport PeerManager, { IDataReceived } from \"../PeerComponent/PeerManager\";\r\nimport Stage from \"./Stage\";\r\nimport StageInGame from \"./StageInGame\";\r\nimport StageMgr, { Stages } from \"./StageMgr\";\r\n\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class StageGameEnd extends Stage {\r\n\r\n    @property(cc.Button) btnPlay: cc.Button = null;\r\n    @property(cc.Button) btnBack: cc.Button = null;\r\n    @property(cc.Node) playerRankBases: cc.Node[] = [];\r\n    @property(cc.Animation) fireWorks: cc.Animation[] = [];\r\n    @property(cc.Node) endGameMulti: cc.Node = null;\r\n    @property(cc.Node) endGameSingle: cc.Node = null;\r\n\r\n    static Instance: StageGameEnd = null;\r\n\r\n    private dragonSkin: string[] =[\"Char3\", \"Char2\", \"Char1\"];\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        StageGameEnd.Instance = this;\r\n    }\r\n\r\n    start () {\r\n        this.btnPlay.interactable = true;\r\n        this.btnBack.interactable = false;\r\n    }\r\n\r\n    // update (dt) {}\r\n\r\n    showResult(rank) {\r\n        if(rank.length > 1) {\r\n            this.endGameMulti.active = true;\r\n            this.endGameSingle.active = false;\r\n            for (let i = 0; i < 3; i++) {\r\n                if(i < rank.length) {\r\n                    let msg: IDataReceived = {\r\n                        phase: PeerPhase.GAMEOVER,\r\n                        action: PeerActionType.ENDGAME,\r\n                        customParam: \"\",\r\n                        rank: i,\r\n                        score: rank[i].score,\r\n                    }\r\n    \r\n                    PeerManager.Instance.sendMessage(rank[i].playerIndex, msg);\r\n    \r\n                    this.playerRankBases[i].active = true;\r\n                    this.playerRankBases[i].getChildByName(\"playerSprite\").getComponent(sp.Skeleton)\r\n                        .setSkin(this.dragonSkin[rank[i].playerIndex]);\r\n                    this.playerRankBases[i].getChildByName(\"player\").getComponent(cc.Label).string =\r\n                        `${GameDefine.player} ${rank[i].playerIndex + 1}`;\r\n                    this.playerRankBases[i].getChildByName(\"lblScore\").getComponent(cc.Label).string = \r\n                        rank[i].score.toString();\r\n                } else {\r\n                    this.playerRankBases[i].active = false;\r\n                }\r\n            }\r\n        } else {\r\n            this.endGameMulti.active = false;\r\n            this.endGameSingle.active = true;\r\n\r\n            let highScore = localStorage.getItem('highScoreZigZag');\r\n            if(!highScore || highScore < rank[0].score) {\r\n                highScore = rank[0].score;\r\n            }\r\n            localStorage.setItem('highScoreZigZag', highScore);\r\n\r\n            this.endGameSingle.getChildByName(\"player\").getComponent(cc.Label).string =\r\n                `${GameDefine.player} ${rank[0].playerIndex + 1}`;\r\n            this.endGameSingle.getChildByName(\"lblScore\").getComponent(cc.Label).string = \r\n                rank[0].score.toString();\r\n            this.endGameSingle.getChildByName(\"lblHighScore\").getComponent(cc.Label).string = \r\n                highScore.toString();\r\n            this.endGameSingle.getChildByName(\"playerSprite\").getComponent(sp.Skeleton)\r\n                .setSkin(this.dragonSkin[rank[0].playerIndex]);\r\n        }\r\n\r\n        StageMgr.show(Stages.StageGameEnd);\r\n        SoundMgr.playSfx(SoundMgr.Instance.SFX_ENDSCREEN);\r\n        // for(let i = 0; i<this.fireWorks.length; i++) {\r\n        //     setTimeout(()=>{\r\n        //         this.fireWorks[i].play();\r\n        //         this.fireWorks[i].getAnimationState(\"FireWork\").repeatCount = 2;\r\n        //     }, 800 + 600 * i);\r\n        // }\r\n    }\r\n\r\n    nextStage() {\r\n        SoundMgr.playSfx(SoundMgr.Instance.SFX_BUTTON);\r\n        this.btnPlay.interactable = true;\r\n        this.btnBack.interactable = false;\r\n\r\n        cc.tween(this.btnPlay.node).to(0.1, {scale: 0.65}).to(0.1, {scale: 0.5})\r\n        .call(()=>{\r\n            StageMgr.show(Stages.StageLobby);\r\n        }).start();\r\n    }\r\n\r\n    previousStage() {\r\n        let msg: IDataReceived = {\r\n            phase: PeerPhase.GAMEOVER,\r\n            action: PeerActionType.BACK,\r\n            customParam: \"\"\r\n        }\r\n        PeerManager.Instance.sendMessageToAll(msg);\r\n        \r\n        SoundMgr.playSfx(SoundMgr.Instance.SFX_BUTTON);\r\n        this.btnPlay.interactable = false;\r\n        this.btnBack.interactable = true;\r\n       \r\n        cc.tween(this.btnBack.node).to(0.1, {scale: 0.65}).to(0.1, {scale: 0.5})\r\n        .call(()=>{\r\n            StageMgr.Instance.sendMessage(\"goBack\"); \r\n        }).start();\r\n    }\r\n\r\n    chooseButton(isBtnNext: boolean) {\r\n        SoundMgr.playSfx(SoundMgr.Instance.SFX_SELECT);\r\n        this.btnBack.interactable = !isBtnNext;\r\n        this.btnPlay.interactable = isBtnNext;\r\n    }\r\n}\r\n"]}