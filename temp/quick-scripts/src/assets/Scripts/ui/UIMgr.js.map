{"version":3,"sources":["assets\\Scripts\\ui\\UIMgr.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// import GameMgr from \"../game/GameMgr\";\r\nimport Helper from \"../utils/Helper\";\r\nimport SingletonNode from \"../utils/SingletonNode\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\nexport enum UIs\r\n{\r\n    UIInterstitial,\r\n    UIWaiting,\r\n    UIGame,\r\n    UIScan,\r\n    UIGuide\r\n}\r\n\r\nexport enum UI_SHOW_EFFECT\r\n{\r\n    APPEAR,\r\n    MOVE,\r\n    SCALE,\r\n    FADE\r\n}\r\n\r\nexport enum UI_MOVE_DIRECTION\r\n{\r\n    UP,\r\n    DOWN,\r\n    LEFT,\r\n    RIGHT\r\n}\r\n\r\n@ccclass\r\nexport default class UIMgr extends SingletonNode<UIMgr>()\r\n{\r\n    set MoveDirection(value: UI_MOVE_DIRECTION)\r\n    {\r\n        this.mMoveDirection = value;\r\n    }\r\n    \r\n    get CurrentView(): cc.Node \r\n    {\r\n        return this.mCurrentView;\r\n    }\r\n\r\n    @property(cc.Prefab) private UIPrefabs: Array<cc.Prefab> = [];\r\n    \r\n    private Canvas: cc.Node = null;\r\n    private mMoveDirection: UI_MOVE_DIRECTION = UI_MOVE_DIRECTION.LEFT;\r\n    private mPreviousView: cc.Node = null;\r\n    private mCurrentView: cc.Node = null;\r\n\r\n    static show(viewName: UIs, \r\n        effectType: UI_SHOW_EFFECT = UI_SHOW_EFFECT.APPEAR, \r\n        easing: string = \"smooth\", \r\n        duration: number = 0.5)\r\n    {\r\n        const instance = this.Instance;\r\n        instance.mPreviousView = instance.mCurrentView;\r\n\r\n        for(let view of instance.node.children)\r\n        {\r\n            const isActive = view.name == UIs[viewName];\r\n            if(isActive)\r\n            {\r\n                instance.mCurrentView = view;\r\n            }\r\n\r\n            if(view.active != isActive)\r\n            {\r\n                view.active = isActive;\r\n            }\r\n        }\r\n\r\n        if(instance.mPreviousView && instance.mCurrentView && instance.mPreviousView != instance.mCurrentView)\r\n        {\r\n            instance.animate(effectType, easing, duration);\r\n        }\r\n    }\r\n    static hide()\r\n    {\r\n        const instance = this.Instance;\r\n        for(let view of instance.node.children)\r\n        {\r\n            view.active = false;\r\n        }\r\n    }\r\n\r\n    static nextView(isNext: boolean = true,\r\n        effectType: UI_SHOW_EFFECT, \r\n        easing: string, \r\n        duration: number\r\n    ) \r\n    {\r\n        const instance = this.Instance;\r\n        let index = instance.node.children.indexOf(instance.mCurrentView);\r\n\r\n        if(index != -1 && ((isNext && index < instance.node.childrenCount - 1) || (!isNext && index > 0)))\r\n        {\r\n            index = isNext ? (index + 1) : (index - 1);\r\n            this.show(Helper.GetIndexEnum(UIs, instance.node.children[index].name), effectType, easing, duration);\r\n        }\r\n    }\r\n\r\n    static getUI<T>(viewName: UIs): T {\r\n        return this.Instance.node.getChildByName(UIs[viewName]).getComponent(UIs[viewName]);\r\n    }\r\n\r\n    onLoad(){\r\n        super.onLoad();\r\n        for (let i = 0; i < this.UIPrefabs.length; i++) {\r\n            const node = cc.instantiate(this.UIPrefabs[i]);\r\n            node.active = false;\r\n            this.node.addChild(node);\r\n        }\r\n\r\n        this.Canvas = cc.find(\"Canvas\");\r\n    }\r\n\r\n    start(){\r\n        \r\n    }\r\n\r\n    private animate(effectType: UI_SHOW_EFFECT, easing: string, duration: number)\r\n    {\r\n        this.mPreviousView.active = true;\r\n\r\n        switch(effectType)\r\n        {\r\n            case UI_SHOW_EFFECT.APPEAR:\r\n            {\r\n                this.mPreviousView.active = false;\r\n                break;   \r\n            }\r\n            case UI_SHOW_EFFECT.MOVE:\r\n            {\r\n                let previousViewPosition;\r\n                let currentViewPosition;\r\n                switch(this.mMoveDirection)\r\n                {\r\n                    case UI_MOVE_DIRECTION.UP:\r\n                    {\r\n                        currentViewPosition = cc.v2(0, - this.Canvas.height * 1.5);\r\n                        previousViewPosition = cc.v2(0, this.Canvas.height* 1.5);\r\n                        break;\r\n                    }\r\n                    case UI_MOVE_DIRECTION.DOWN:\r\n                    {\r\n                        currentViewPosition = cc.v2(0, this.Canvas.height* 1.5);\r\n                        previousViewPosition = cc.v2(0, - this.Canvas.height* 1.5);\r\n                        break;\r\n                    }\r\n                    case UI_MOVE_DIRECTION.LEFT:\r\n                    {\r\n                        currentViewPosition = cc.v2(this.Canvas.width * 1.5, 0);\r\n                        previousViewPosition = cc.v2(- this.Canvas.width * 1.5, 0);\r\n                        break;\r\n                    }\r\n                    case UI_MOVE_DIRECTION.RIGHT:\r\n                    {\r\n                        currentViewPosition = cc.v2(- this.Canvas.width * 1.5, 0);\r\n                        previousViewPosition = cc.v2(this.Canvas.width * 1.5, 0);\r\n                        break;\r\n                    }\r\n                }\r\n\r\n                cc.tween(this.mPreviousView)\r\n                    .to(duration, {position: previousViewPosition}, {easing})\r\n                    .call(() => this.mPreviousView.active = false)\r\n                    .start();\r\n                cc.tween(this.mCurrentView)\r\n                    .set({opacity :0})\r\n                    .delay(0)\r\n                    .set({position : currentViewPosition, opacity : 255})\r\n                    .to(duration, {position: cc.Vec3.ZERO}, {easing})\r\n                    .start();\r\n                \r\n                break;   \r\n            }\r\n            case UI_SHOW_EFFECT.SCALE:\r\n            {\r\n                this.mCurrentView.setScale(cc.Vec2.ZERO);\r\n                cc.tween(this.mPreviousView)\r\n                    .to(duration, {scale: 0}, {easing})\r\n                    .call(() => this.mPreviousView.active = false)\r\n                    .start();\r\n                cc.tween(this.mCurrentView)\r\n                    .delay(duration)\r\n                    .to(duration, {scale: 1}, {easing})\r\n                    .start();\r\n                    \r\n                break;   \r\n            }\r\n            case UI_SHOW_EFFECT.FADE:\r\n            {\r\n                cc.tween(this.mPreviousView)\r\n                    .to(duration, {scale: this.mPreviousView.scaleX}, {progress: (start, end, current, ratio) => {\r\n                        this.mPreviousView.opacity = (1 - ratio) * 255;\r\n                        return start + (end - start) * ratio;\r\n                    }})\r\n                    .call(() => this.mPreviousView.active = false)\r\n                    .start();\r\n                cc.tween(this.mCurrentView)\r\n                    .delay(duration)\r\n                    .to(duration, {scale: this.mCurrentView.scaleX}, {progress: (start, end, current, ratio) => {\r\n                        this.mCurrentView.opacity = ratio * 255;\r\n                        return start + (end - start) * ratio;\r\n                    }})\r\n                    .start();\r\n                    \r\n                break;   \r\n            }\r\n        }    \r\n        this.mCurrentView.active = true;\r\n    }\r\n}\r\n"]}