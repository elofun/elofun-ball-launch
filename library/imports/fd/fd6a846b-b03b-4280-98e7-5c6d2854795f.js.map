{"version":3,"sources":["assets\\Scripts\\stage\\StageMgr.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import Stage from \"./Stage\";\r\nimport SingletonNode from \"../utils/SingletonNode\";\r\nimport GameMgr from \"../game/GameManager\";\r\nimport Helper from \"../utils/Helper\";\r\nimport GameDefine from \"../game/GameDefine\";\r\nimport PeerManager, { IDataReceived } from \"../PeerComponent/PeerManager\";\r\nimport StageQRscan from \"./StageQRscan\";\r\nimport StageLobby from \"./StageLobby\";\r\nimport StageGameEnd from \"./StageGameEnd\";\r\nimport StageInGame from \"./StageInGame\";\r\nimport {\r\n  PeerActionType,\r\n  PeerPhase,\r\n  PeerStage,\r\n} from \"../PeerComponent/PeerDefine\";\r\nimport StageStartGame from \"./StageStartGame\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\nexport enum Stages {\r\n  StageQRscan,\r\n  StageLobby,\r\n  StageInGame,\r\n  StageGameEnd,\r\n  StageStartGame,\r\n  StageTestGame,\r\n}\r\n\r\n@ccclass\r\nexport default class StageMgr extends SingletonNode<StageMgr>() {\r\n  @property(cc.Prefab) private StagePrefabs: Array<cc.Prefab> = [];\r\n  private StageCover: cc.Node = null;\r\n  private isTweening: boolean = false;\r\n\r\n  get CurrentStage(): cc.Node {\r\n    return this.mCurrentStage;\r\n  }\r\n\r\n  private mPreviousStage: cc.Node = null;\r\n  private mCurrentStage: cc.Node = null;\r\n  private inputCode: number[] = [];\r\n\r\n  static show(stageName: Stages, duration: number = 0.5) {\r\n    if (StageMgr.Instance.isTweening) {\r\n      return;\r\n    }\r\n    const instance = this.Instance;\r\n    instance.mPreviousStage = instance.mCurrentStage;\r\n\r\n    for (let stage of instance.node.children) {\r\n      const isActive = stage.name == Stages[stageName];\r\n\r\n      if (isActive) {\r\n        instance.mCurrentStage = stage;\r\n      }\r\n\r\n      if (stage.active != isActive) {\r\n        stage.active = isActive;\r\n      }\r\n    }\r\n\r\n    if (\r\n      instance.mPreviousStage &&\r\n      instance.mCurrentStage &&\r\n      instance.mPreviousStage != instance.mCurrentStage\r\n    ) {\r\n      instance.animate(duration);\r\n    } else {\r\n      instance.mCurrentStage.getComponent(Stage).init();\r\n    }\r\n\r\n    let msg: IDataReceived = {\r\n      phase: PeerPhase.NONE,\r\n      action: PeerActionType.SHOW,\r\n      customParam: \"\",\r\n    };\r\n    return;\r\n    PeerManager.Instance.PlayGame(false);\r\n\r\n    switch (stageName) {\r\n      case Stages.StageInGame:\r\n        StageInGame.Instance.initial();\r\n        PeerManager.Instance.PlayGame();\r\n        msg.phase = PeerPhase.INGAME;\r\n        break;\r\n      case Stages.StageLobby:\r\n        msg.phase = PeerPhase.WAITING;\r\n        break;\r\n      case Stages.StageGameEnd:\r\n        msg.phase = PeerPhase.GAMEOVER;\r\n        break;\r\n    }\r\n\r\n    PeerManager.Instance.sendMessageToAll(msg);\r\n  }\r\n\r\n  static nextStage(isNext: boolean = true, duration: number = 0.5) {\r\n    const instance = this.Instance;\r\n    let index = instance.node.children.indexOf(instance.mCurrentStage);\r\n\r\n    if (!isNext && index == 0) {\r\n      // window.location = GameDefine.DEEP_LINK_BACK;\r\n    } else if (\r\n      index != -1 &&\r\n      ((isNext && index < instance.node.childrenCount - 1) ||\r\n        (!isNext && index > 0))\r\n    ) {\r\n      index = isNext ? index + 1 : index - 1;\r\n      StageMgr.show(\r\n        Helper.GetIndexEnum(Stages, instance.node.children[index].name),\r\n        duration\r\n      );\r\n    }\r\n  }\r\n\r\n  onLoad() {\r\n    super.onLoad();\r\n    for (let i = 0; i < this.StagePrefabs.length; i++) {\r\n      const node = cc.instantiate(this.StagePrefabs[i]);\r\n      this.node.addChild(node);\r\n      node.active = false;\r\n    }\r\n\r\n    cc.systemEvent.on(\r\n      cc.SystemEvent.EventType.KEY_DOWN,\r\n      (event: cc.Event.EventKeyboard) => {\r\n        this.inputCode.push(event.keyCode);\r\n        if (this.inputCode.length >= 4) {\r\n          if (this.inputCode.toString() == [54, 55, 56, 57].toString()) {\r\n            cc.debug.setDisplayStats(true);\r\n          }\r\n          this.inputCode.shift();\r\n        }\r\n        if (PeerManager.Instance.isPlayWithRemote) {\r\n          switch (StageMgr.Instance.CurrentStage.name) {\r\n            case Stages[Stages.StageQRscan]:\r\n              if (event.keyCode == 13) {\r\n                StageQRscan.Instance.nextStage(true);\r\n                PeerManager.Instance.setRemoteMode(true);\r\n              }\r\n              break;\r\n            case Stages[Stages.StageStartGame]:\r\n              if (event.keyCode == 13) {\r\n                StageStartGame.Instance.nextStage(true);\r\n              }\r\n              break;\r\n            case Stages[Stages.StageLobby]:\r\n              if (event.keyCode == 13) {\r\n                StageLobby.Instance.nextStage();\r\n              }\r\n              break;\r\n            case Stages[Stages.StageGameEnd]:\r\n              if (event.keyCode == 37) {\r\n                StageGameEnd.Instance.chooseButton(false);\r\n              } else if (event.keyCode == 39) {\r\n                StageGameEnd.Instance.chooseButton(true);\r\n              } else if (event.keyCode == 13) {\r\n                if (StageGameEnd.Instance.btnPlay.interactable) {\r\n                  StageGameEnd.Instance.nextStage();\r\n                } else {\r\n                  StageGameEnd.Instance.previousStage();\r\n                }\r\n              }\r\n              break;\r\n          }\r\n        }\r\n      }\r\n    );\r\n\r\n    window.addEventListener(\"message\", this.onReciveMessage.bind(this), false);\r\n\r\n    this.sendMessage(\"getControllerURL\"); // có thể thêm customParam nếu muốn\r\n    this.sendMessage(\"getPrefix\");\r\n    this.sendMessage(\"getControllerOrigin\");\r\n  }\r\n\r\n  onReciveMessage(e) {\r\n    if (e.data && e.data.action) {\r\n      let msg = e.data;\r\n      switch (msg.action) {\r\n        case \"getPrefix\": {\r\n          window.controllerPrefix = msg.message;\r\n          break;\r\n        }\r\n        case \"getControllerURL\": {\r\n          window.controllerURL = msg.message;\r\n          break;\r\n        }\r\n        case \"getControllerOrigin\": {\r\n          window.controllerOrigin = msg.message;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  sendMessage(action: string, customParam: any = null) {\r\n    let msg = {\r\n      action: action,\r\n      game: \"zig-zag\", // game nào thì đặt tên đó (giống tên folder chứa game)\r\n      customParam: customParam,\r\n    };\r\n    (window as any).parent.postMessage(msg, \"*\");\r\n  }\r\n\r\n  start() {\r\n    this.StageCover = cc.find(\"Canvas\").getChildByName(\"Stage Cover\");\r\n    this.StageCover.active = false;\r\n\r\n    StageMgr.show(Stages.StageQRscan);\r\n  }\r\n\r\n  private animate(duration: number) {\r\n    this.mPreviousStage.active = true;\r\n    this.mCurrentStage.active = false;\r\n    this.isTweening = true;\r\n\r\n    this.StageCover.active = true;\r\n    cc.tween(this.mPreviousStage)\r\n      .to(\r\n        duration,\r\n        { scale: this.mPreviousStage.scaleX },\r\n        {\r\n          progress: (start, end, current, ratio) => {\r\n            // this.mPreviousStage.opacity = (1 - ratio) * 255;\r\n            this.StageCover.opacity = ratio * 255;\r\n            return start + (end - start) * ratio;\r\n          },\r\n        }\r\n      )\r\n      .call(() => {\r\n        this.mPreviousStage.active = false;\r\n        this.mCurrentStage.active = true;\r\n        this.mCurrentStage.getComponent(Stage).init();\r\n      })\r\n      .start();\r\n    cc.tween(this.mCurrentStage)\r\n      .delay(duration)\r\n      .to(\r\n        duration,\r\n        { scale: this.mCurrentStage.scaleX },\r\n        {\r\n          progress: (start, end, current, ratio) => {\r\n            // this.mCurrentStage.opacity = ratio * 255;\r\n            this.StageCover.opacity = (1 - ratio) * 255;\r\n            return start + (end - start) * ratio;\r\n          },\r\n        }\r\n      )\r\n      .call(() => {\r\n        this.StageCover.active = false;\r\n        this.isTweening = false;\r\n      })\r\n      .start();\r\n  }\r\n}\r\n"]}