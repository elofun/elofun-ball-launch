{"version":3,"sources":["assets\\Scripts\\stage\\StageQRscan.ts"],"names":[],"mappings":";;;;;AAAA,oBAAoB;AACpB,wEAAwE;AACxE,mBAAmB;AACnB,kFAAkF;AAClF,8BAA8B;AAC9B,kFAAkF;;;;;;;;;;;;;;;;;;;;;AAElF,2CAAsC;AACtC,+CAA0C;AAC1C,4DAAuD;AACvD,wDAAmD;AACnD,iCAA4B;AAC5B,2CAAsC;AACtC,uCAA8C;AAExC,IAAA,KAAwB,EAAE,CAAC,UAAU,EAAnC,OAAO,aAAA,EAAE,QAAQ,cAAkB,CAAC;AAG5C;IAAyC,+BAAK;IAA9C;QAAA,qEA4CC;QA3CsB,YAAM,GAAc,IAAI,CAAC;;IA2ChD,CAAC;oBA5CoB,WAAW;IAI9B,wBAAwB;IAExB,4BAAM,GAAN;QACE,aAAW,CAAC,QAAQ,GAAG,IAAI,CAAC;IAC9B,CAAC;IAED,2BAAK,GAAL;QAAA,iBAsBC;QArBC,kBAAQ,CAAC,SAAS,CAAC,kBAAQ,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;QAE1C,IAAI,SAAS,GAAG,IAAI,eAAe,CAAC,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;QAC5D,IAAI,WAAW,GAAG,MAAM,CAAC,SAAS,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC,IAAI,KAAK,CAAC;QAC7D,gBAAM,CAAC,QAAQ,CAAC,WAAW,GAAG,IAAI,CAAC,GAAG,EAAE,GAAG,WAAW,CAAC;QAEvD,OAAO;QACP,IAAI,QAAQ,GAAG,WAAW,CAAC;YACzB,IAAI,qBAAW,CAAC,QAAQ,CAAC,IAAI,IAAI,qBAAW,CAAC,QAAQ,CAAC,GAAG,EAAE;gBACzD,KAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC;gBACvB,oBAAU,CAAC,QAAQ,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC;gBACtC,oBAAU,CAAC,QAAQ,CAAC,WAAW,CAAC,MAAM;oBACpC,EAAE,GAAG,MAAM,CAAC,gBAAgB,GAAG,qBAAW,CAAC,QAAQ,CAAC,GAAG,CAAC;gBAC1D,aAAa,CAAC,QAAQ,CAAC,CAAC;gBACxB,OAAO;aACR;YACD,IAAI,gBAAM,CAAC,QAAQ,CAAC,WAAW,GAAG,IAAI,CAAC,GAAG,EAAE,GAAG,CAAC,EAAE;gBAChD,kBAAQ,CAAC,QAAQ,CAAC,WAAW,CAAC,WAAW,CAAC,CAAC;gBAC3C,aAAa,CAAC,QAAQ,CAAC,CAAC;aACzB;QACH,CAAC,EAAE,IAAI,CAAC,CAAC;IACX,CAAC;IAED,iBAAiB;IAEjB,+BAAS,GAAT,UAAU,QAAyB;QAAzB,yBAAA,EAAA,gBAAyB;QACjC,IAAI,QAAQ,EAAE;YACZ,kBAAQ,CAAC,OAAO,CAAC,kBAAQ,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC;YAC/C,kBAAQ,CAAC,IAAI,CAAC,iBAAM,CAAC,cAAc,CAAC,CAAC;SACtC;aAAM;YACL,kBAAQ,CAAC,IAAI,CAAC,iBAAM,CAAC,cAAc,CAAC,CAAC;SACtC;IACH,CAAC;;IAxCM,oBAAQ,GAAgB,IAAI,CAAC;IAFf;QAApB,QAAQ,CAAC,mBAAS,CAAC;+CAA0B;IAD3B,WAAW;QAD/B,OAAO;OACa,WAAW,CA4C/B;IAAD,kBAAC;CA5CD,AA4CC,CA5CwC,eAAK,GA4C7C;kBA5CoB,WAAW","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nimport Global from \"../common/Global\";\r\nimport SoundMgr from \"../common/SoundMgr\";\r\nimport PeerManager from \"../PeerComponent/PeerManager\";\r\nimport QRCodeGen from \"../PeerComponent/QRCodeGen\";\r\nimport Stage from \"./Stage\";\r\nimport StageLobby from \"./StageLobby\";\r\nimport StageMgr, { Stages } from \"./StageMgr\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class StageQRscan extends Stage {\r\n  @property(QRCodeGen) qrCode: QRCodeGen = null;\r\n\r\n  static Instance: StageQRscan = null;\r\n  // LIFE-CYCLE CALLBACKS:\r\n\r\n  onLoad() {\r\n    StageQRscan.Instance = this;\r\n  }\r\n\r\n  start() {\r\n    SoundMgr.playMusic(SoundMgr.Instance.BGM);\r\n\r\n    let urlParams = new URLSearchParams(window.location.search);\r\n    let timerGoBack = Number(urlParams.get(\"timer_qr\")) || 30000;\r\n    Global.Instance.backAppTime = Date.now() + timerGoBack;\r\n\r\n    return;\r\n    let interval = setInterval(() => {\r\n      if (PeerManager.Instance.peer && PeerManager.Instance.sip) {\r\n        this.qrCode.createQR();\r\n        StageLobby.Instance.qrCode.createQR();\r\n        StageLobby.Instance.lblRoomCode.string =\r\n          \"\" + window.controllerPrefix + PeerManager.Instance.sip;\r\n        clearInterval(interval);\r\n        return;\r\n      }\r\n      if (Global.Instance.backAppTime - Date.now() < 0) {\r\n        StageMgr.Instance.sendMessage(\"backToApp\");\r\n        clearInterval(interval);\r\n      }\r\n    }, 1000);\r\n  }\r\n\r\n  // update (dt) {}\r\n\r\n  nextStage(isRemote: boolean = false) {\r\n    if (isRemote) {\r\n      SoundMgr.playSfx(SoundMgr.Instance.SFX_BUTTON);\r\n      StageMgr.show(Stages.StageStartGame);\r\n    } else {\r\n      StageMgr.show(Stages.StageStartGame);\r\n    }\r\n  }\r\n}\r\n"]}