{"version":3,"sources":["assets\\Scripts\\PeerComponent\\PeerAction.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nimport PeerClientManager from \"./PeerClientManager\";\r\nimport { PeerActionType, PeerPhase } from \"./PeerDefine\";\r\nimport PeerManager, { IDataReceived } from \"./PeerManager\";\r\n\r\nexport enum PeerType {\r\n  NONE,\r\n  SEND,\r\n  RECEIVE,\r\n}\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n@ccclass(\"PeerHandler\")\r\nclass PeerHandler {\r\n  @property({ type: cc.Enum(PeerActionType) }) actionName: PeerActionType =\r\n    PeerActionType.NONE;\r\n  @property(cc.Component.EventHandler)\r\n  eventHandler: Array<cc.Component.EventHandler> = [];\r\n  @property()\r\n  customMessage: string = \"\";\r\n}\r\n@ccclass\r\nexport default class PeerAction extends cc.Component {\r\n  @property({ type: cc.Enum(PeerType) }) type: PeerType = PeerType.NONE;\r\n  @property({ type: cc.Enum(PeerPhase) }) actionPhase: PeerPhase =\r\n    PeerPhase.NONE;\r\n  @property({\r\n    type: PeerHandler,\r\n    visible: function (this: PeerAction) {\r\n      return this.type == PeerType.RECEIVE;\r\n    },\r\n  })\r\n  actionHandler: Array<PeerHandler> = [];\r\n  @property({\r\n    type: cc.Enum(PeerActionType),\r\n    visible: function (this: PeerAction) {\r\n      return this.type == PeerType.SEND;\r\n    },\r\n  })\r\n  actionName: PeerActionType = PeerActionType.NONE;\r\n  @property({\r\n    type: cc.Component.EventHandler,\r\n    visible: function (this: PeerAction) {\r\n      return this.type == PeerType.SEND;\r\n    },\r\n  })\r\n  eventHandler: Array<cc.Component.EventHandler> = [];\r\n  @property({\r\n    visible: function (this: PeerAction) {\r\n      return this.type == PeerType.SEND;\r\n    },\r\n    type: cc.String,\r\n  })\r\n  customMessage: string = \"\";\r\n\r\n  public playerSIP: number = null;\r\n\r\n  onLoad() {\r\n    // try\r\n    // {\r\n    switch (this.type) {\r\n      case PeerType.NONE:\r\n        break;\r\n      case PeerType.SEND:\r\n        this.node.on(cc.Node.EventType.TOUCH_END, this.hanleSubmit.bind(this));\r\n        break;\r\n      case PeerType.RECEIVE:\r\n        return;\r\n        PeerManager.registerEvent(\r\n          PeerManager.EventReceivedMessage,\r\n          this.handleMessage.bind(this)\r\n        );\r\n        break;\r\n    }\r\n    // } catch (e) { }\r\n  }\r\n  hanleSubmit() {\r\n    if (!this.node.active) return;\r\n    for (let event of this.eventHandler) {\r\n      event && event.emit([]);\r\n    }\r\n    let msg: IDataReceived = {\r\n      action: this.actionName,\r\n      phase: this.actionPhase,\r\n      customParam: this.customMessage,\r\n    };\r\n    console.log(this.customMessage);\r\n    if (PeerClientManager.Instance) PeerClientManager.Instance.sendMessage(msg);\r\n    else if (PeerManager.Instance) PeerManager.Instance.sendMessageToAll(msg);\r\n  }\r\n  handleMessage(e: IDataReceived, client) {\r\n    if (!this.node.active) return;\r\n    if (this.playerSIP == null || this.playerSIP == client.remoteSIP) {\r\n      console.log(e);\r\n      if (e.phase == this.actionPhase) {\r\n        for (let handler of this.actionHandler) {\r\n          if (handler.actionName == e.action) {\r\n            for (let evt of handler.eventHandler) {\r\n              evt && evt.emit([e]);\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n"]}